{% extends "base.html" %}

{% block css %}
  <link rel="stylesheet" href="https://cdn.plyr.io/3.6.2/plyr.css" />
{% endblock %}


{% block content %}
<section class="uk-section uk-section uk-section-muted">
  <div class="uk-container uk-container-expand">
    <div class="uk-grid-match" uk-grid>
      <div class="uk-width-1-1@m">
        <div uk-grid class="uk-grid-small">
          <div class="uk-width-expand@m">
            <div class="uk-card no-scale uk-card-default uk-border-rounded uk-card-body uk-padding-small">
              <video src="{{ url_for('static', filename='media/filters.mp4') }}" id="player" controls playsinline></video>
            </div>
          </div>
          <div class="uk-width-1-4@m">
            <div class="uk-card no-scale uk-card-default scroll">
              <div class="uk-card-body">
                <ul class="uk-list uk-list-large uk-list-divider">
                  {% for quote in course.quotes %}
                    <li>
                      <a onclick="setTime('{{ quote.quote_time }}')" class="uk-link-reset uk-flex uk-flex-between">
                        <span>{{ quote.title }}</span>
                        <span>
                          {{ quote.quote_time | format_time_to_string }}
                        </span>
                      </a>
                    </li>
                  {% endfor %}              
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="uk-width-expand@m">
        <div class="uk-card no-scale uk-card-large uk-card-default uk-card-body uk-border-rounded">
          <div>
            <h3 class="uk-card-title uk-margin-remove-bottom">
              Descrição
            </h3>
            <p>
              {{ course.description | safe }}
            </p>
          </div>
        </div>
      </div>
      <div class="uk-width-1-4@m">
        <div class="uk-card no-scale uk-card-default uk-card-body uk-border-rounded">
          <div>
            <div class="uk-flex uk-flex-between uk-margin-large-bottom">
              <span class="uk-text-meta">
                <ion-icon name="time-outline"></ion-icon>
                <span class="uk-text-top">
                  {{ course.duration }} minutos
                </span>
              </span>
              <span class="uk-text-meta">
                <ion-icon name="calendar-outline"></ion-icon>
                <span class="uk-text-top">
                  Atualizado: 06/2020
                </span>
              </span>
            </div>         
            
            <div class="uk-button-watch">
              <div class="uk-margin">
                <a href="{{ course.source_code_url }}" class="uk-button uk-width-1-1@m uk-button-secondary">
                  <span uk-icon="code"></span>
                  Código Fonte
                </a>
              </div>
              <div class="uk-margin">
                <a href="{{ course.video_url }}" class="uk-button uk-width-1-1@m uk-button-danger">
                  <span uk-icon="download"></span>
                  Download Curso
                </a>
              </div>
            </div>

            <div class="meta-labels">
              {% for tag in course.tags %}
               <span class="uk-label uk-label-muted">{{ tag.name }}</span>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}


{% block scripts %}
<script src="https://cdn.plyr.io/3.6.2/plyr.js"></script>
<script>
  window.onload = function() {
    let player = new Plyr('#player', {
      autoplay: true,
    });
    player.currentTime = parseInt(localStorage.getItem("currentTime") || 0);
  }
 
  window.onbeforeunload = function(e) {
    localStorage.setItem("currentTime", player.currentTime);
  }

  function setTime(seconds) {
    player.currentTime = seconds;
  }

</script>
{%endblock%}